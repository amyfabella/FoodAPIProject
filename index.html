<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Meals and Deals!</title>

    <link
    rel="stylesheet"
    href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
    integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
    crossorigin="anonymous"/>
    <link
    href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap"
    rel="stylesheet"/>
    <link rel="stylesheet" href="style.css" />
</head>
<body>

    <!--MY RECIPE UPLOAD BTN 
    <form action="/action_page.php">
        <input type="file" id="myFile" name="filename">   
        <input type="submit" value="Upload MB">
    </form> -->
    
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script type="text/javascript">
    //FOR TESTING SPOONACULAR API
    //var recipe = prompt('What recipe do you want?');
        //recipeParams.q = $("#search-term")
        //.val()
        //.trim();

    //SPOONACULAR VARIABLES
    //var SpoonacularApiKey = 4b7cbd71e4304fe491c6f169aa6cc0af;
    var APIkey = "4b7cbd71e4304fe491c6f169aa6cc0af";
    var findFood = $("#find-food").val();
    var chosenDiet = $(".diet-filters").checked; //--> for loop?;
    var chosenIntolerance = $(".intolerance-filters").checked; //--> for loop?
        //URL example: "https://api.spoonacular.com/recipes/search?query=lasagna&apiKey=4b7cbd71e4304fe491c6f169aa6cc0af&number=5&diet=vegetarian&intolerances=gluten&ingredients=cheese, tomato"
        //checkboxes: https://www.w3schools.com/jsref/tryit.asp?filename=tryjsref_checkbox_checked

    //SPOONACULAR RECIPE SETTINGS --> FOR LOOP IF <1 FILTER?
    if (chosenDiet == null & chosenIntolerance == null) {
         var spoonacularRecipeSettings = {
        "url": "https://api.spoonacular.com/recipes/search?query=" + findFood + "&apiKey=" + APIkey,
        "method": "GET",
        "timeout": 0,
        "headers": {
             "": "4b7cbd71e4304fe491c6f169aa6cc0af"
            },
        };
    }
    if (chosenDiet !== null & chosenIntolerance == null) {
         var spoonacularRecipeSettings = {"url": "https://api.spoonacular.com/recipes/search?query=" + findFood + "&apiKey=" + APIkey + "&number=5&diet=" + chosenDiet,
        "method": "GET",
         "timeout": 0,
         "headers": {
             "": "4b7cbd71e4304fe491c6f169aa6cc0af"
            },
        };
    } 
    if (chosenDiet == null & chosenIntolerance !== null) {
         var spoonacularRecipeSettings = {"url": "https://api.spoonacular.com/recipes/search?query=" + findFood + "&apiKey=" + APIkey + "&number=5&intolerances=" + chosenIntolerance,
         "method": "GET",
         "timeout": 0,
         "headers": {
             "": "4b7cbd71e4304fe491c6f169aa6cc0af"
            },
        };
    }    
    if (chosenDiet !== null & chosenIntolerance !== null) {
         var spoonacularRecipeSettings = {"url": "https://api.spoonacular.com/recipes/search?query=" + findFood + "&apiKey=" + APIkey + "&number=5&diet=" + chosenDiet + "&intolerances=" + chosenIntolerance,
         "method": "GET",
         "timeout": 0,
         "headers": {
             "": "4b7cbd71e4304fe491c6f169aa6cc0af"
            },
        };
    }

    //GIPHY VARIABLES
    var gordonRamsey = $(this).attr("data-gordon-ramsey");
    var giphyURL = "https://api.giphy.com/v1/gifs/search?q=" + gordonRamsey + "&api_key=dc6zaTOxFJmzC&limit=10";

    //UPLOAD BTN FOR MY RECIPE... NEW API?
    var submitBtn = $("#submit");
    var uploadDiv = $("#my-recipe").val();
    var upload;
    var filePath = $("spinFilePath");
    //CREATE MY RECIPE
    var myRecipeName = $("#my-recipe-name").val();
    var myIngredientsStr = $.trim($(".my-ingredients").val());
    var myIngredientsSplit = myIngredientsStr.split(" ");
    var myIngredientsArr = Array.from(myIngredientsSplit); //--> or one input for one ingredient then add button for more?
    var myDirections = $("#my-directions").val();
    var myRecipeImage; //=image upload?
    //FOR LOOP
    for (var i=0; i < myIngredientsArr.length; i++){

    }
    //CREATING TAGS
    var myRecipeDiv = $("<div>");
    var myRecipeNameH = $("<h>");
    var myIngredientsUl = $("<ul>");
    var myIngredientsLi = $("<li>"); //--> for loop?
    var myDirectionsP = $("<p>");
    var myRecipeImageImg = $("<img>");
    //PUTTING DATA INTO TAGS
    $(myRecipeNameH).append(myRecipeName);
    $(myIngredientsLi).append(myIngredientsArr[i]); //--> for loop?
    $(myIngredientsUl).append(myIngredientsLi);
    $(myDirectionsP).append(myDirections);
    $(myRecipeImageImg).append(myRecipeImage);
    //ADDING TAGS TO DIV
    $(myRecipeDiv).append(myRecipeNameH);
    $(myRecipeDiv).append(myIngredientsUl);
    $(myRecipeDiv).append(myDirectionsP);
    $(myRecipeDiv).append(myRecipeImageImg);
    //ADDING DIV INTO CORRECT RECIPE CARD
    $("#my-recipe").append(myRecipeDiv);
        

    //UPLOAD MY RECIPE AS FILE?
    //https://www.aspsnippets.com/Articles/Open-Fileupload-Upload-File-on-Button-Click-using-JavaScript-and-jQuery.aspx
    //$(submitBtn).on("click", function(){
        //$(submitBtn).click();

        //fileupload.onchange = function () {
            //var uploadName = fileupload.value.split("\\")[fileupload.value.split("\\").length - 1];
            //filePath.innerHTML = "<b> Selected File: </b>" + uploadName";
        //};
    //})

    //SAVE FOUND RECIPES & MY RECIPES --> SAVE BTN? 
            //BTN FOR MY SAVED FOUND RECIPES
            //BTN FOR MY SAVED RECIPES
    //MAKE RECIPES PERSIST
    
   //ON-CLICK: SEARCH FOR RECIPES
   $.ajax(spoonacularRecipeSettings).done(function(response) {
       console.log(response);
   });

    //ON-CLICK: SELECT SPECIFIC RECIPE
    $.ajax(spoonacularRecipeSettings).done(function(response) {
        console.log(response);

        //CHECK WHICH FILTERS WERE CHOSEN
        $(".diet-filters").innerHTML = chosenDiet;
        $(".intolerance-filters").innerHTML = chosenIntolerances;

        //PULLING DATA, DOUBLE CHECK SCOPE!
        var recipe = response;
        console.log(recipe);
        var priceId = response.id;
        var recipeName = response.recipe.title;
        var recipeSource = response.recipe.url;
        var recipeImage = response.recipe.img;
        var ingredients = response.body.ingredients;
        console.log(ingredients);
        var ingredientsArr = ingredients[i];
        var directions = response.body.instructions;
        //for next ajax call
        var spoonacularPriceSettings = {
            "url": "https://api.spoonacular.com/recipes/" + priceId + "/priceBreakdownWidget.json?apiKey=4b7cbd71e4304fe491c6f169aa6cc0af",
            "method": "GET",
            "timeout": 0,
            "headers": {
                "": "4b7cbd71e4304fe491c6f169aa6cc0af"
            },
        };

        //CREATING TAGS
        var recipeDiv = $("<div>");
        var recipeNameH = $("<h>");
        var chosenFiltersP = $("<p>");
        var recipeSourceA = $("<a>");
        var recipeImageImg = $("<img>");
        var ingredientsUl = $("<ul>");
        var ingredientsLi = $("<li>"); //--> create for loop?
        var directionsP = $("<p>");

        //ADDING ATTRIBUTES TO TAGS
        $(recipeDiv).attr("#recipe-div");
        $(recipeNameH).attr("#recipe-name");
        $(chosenFiltersP).attr(".chosen-filters"); //--> for loop?
        $(recipeSourceA).attr("#recipe-source");
        $(recipeImageImg).attr("#recipe-image");
        $(ingredientsUl).attr("#ingredients-List");
        $(ingredientsLi).attr(".ingredients"); //--> for loop?
        $(directionsP).attr("#directions");

        //PUTTING DATA INTO TAGS
        $(recipeNameH).append(recipeName);
        $(chosenFiltersP).append("Chosen Diet: " + chosenDiet); //--> for loop?
        $(chosenFiltersP).append("Chosen Intolerances: " + chosenIntolerance); //--> for loop?
        $(recipeSourceA).append("Recipe Source: " + recipeSource);
        $(recipeImageImg).append(recipeImage);
        $(ingredientsLi).append(ingredients); //--> for loop?
        $(ingredientsUl).append("Ingredients: " + ingredientsLi);
        $(directionsP).append(directions);

        //MAKING SURE TAGS GO INTO CORRECT DIV
        $(recipeDiv).append(recipeName);
        $(recipeDiv).append(chosenFiltersP); //--> for loop?
        $(recipeDiv).append(recipeSourceA);
        $(recipeDiv).append(recipeImageImg);
        $(recipeDiv).append(ingredientsUl);
        $(recipeDiv).append(directionsP);

        //ADDING DIV TO THE CORRECT RECIPE CARD
        $("#find-recipe").append(recipeDiv);

        //MAKE AND PRINT SHOPPING LIST?

        //GET PRICES FOR INGREDIENTS
        $.ajax(spoonacularPriceSettings).done(function(response) {
        console.log(response);

            //PULLING DATA, CHECK SCOPE!
            var prices = response.recipe.prices;
            var priceArr = Array.from(prices);
            //CREATING TAG
            var priceP = $("<p>");

            //ENSURING PRICES ARE LISTED FOR ALL INGREDIENTS
            for (var i=0; i <prices.length; i++){
                //ADDING DATA TO TAG
                $(priceP).append(priceArr[i]);
                //ADDING TAG AFTER INGREDIENTS LIST
                $(ingredientsUl).append(priceP);
            }
        });

    });





    //GORDON RAMSEY GIFS
    $.ajax({
    url: giphyURL,
    method: "GET",
    })
        .then(function(response){
            console.log(response); 
            var results = response.data;

            for (var i=0; i <results.length; i++) {
                var gifDiv = $("<div>");
                var gifImage = $("<img>");
                gifImage.attr("src", results[i].images.fixed_height.url);
                gifDiv.append(gifImage);
                $("#gifs-appear-here").prepend(gifDiv);
            }
    })        

        //CLEAR/RESET BTN?
        //$("#clear").on("click", function(){
            //$().empty();
            //$().empty();
        //})


    </script>
    

</body>
</html>